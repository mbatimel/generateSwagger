# Цель

Генератор `sg` предназначен для того, чтобы избавить разработчика от необходимости заниматься рутиной(точнее генерить сваггер))))).
Создан для генирации .yaml файлов для компании Wildberries
# Генерация swagger


Для генерации документации в формате [openAPI](https://swagger.io/docs/specification/about/), необходимо выполнить
команду:

```bash
sg sswagger --services . --outFile ../test_swaggers/externalapi/swagger.yaml
```

Где,

`services` - путь до папки с интерфейсом (в норме для `sg` эта папка является рабочей)
`outPath` - путь, где будет сохранён результат

# Аннотация

Аннотацией в терминах `sg` называется комментарий, оформленный специальным образом.
Целью аннотаций является указание генератору параметров и настроек, специфичных для конкретного сервиса.

Аннотации могут быть определены на разных уровнях - пакет, интерфейс, метод интерфейса и на уровне типов.

Аннотации имеют следующие уровни определения:

- на уровне пакета, действуют на все методы всех интерфейсов в этом пакете
- на уровне интерфейса действуют на все методы этого интерфейса
- на уровне метода, действуют только на этот метод

В случае конфликтов, приоритет имеют аннотации с наименьшей зоной действия.

Аннотации имею следующий формат:

```Go
// @sg <имя>=<значение>
```

В случае, когда аннотации имею смысл флагов, значение может не указываться. Несколько аннотаций может быть сгруппировано
в одной строке (разделитель пробел). Например:

```Go
// @sg http-prefix=v1 jsonRPC-server log metrics trace
```

Следующая запись синонимична пред идущей:

```Go
// @sg http-prefix=v1 
// @sg jsonRPC-server 
// @sg log metrics trace
```

## log

- модуль
- интерфейс

Включает генерацию логирования.

## trace

- модуль
- интерфейс

Включает генерацию трассировку методов интерфейсов.

## metrics

- модуль
- интерфейс

Включает генерацию метрик для методов интерфейсов.

## desc=\`краткое описание \`

- модуль
- интерфейс
- метод
- тип

Добавляет краткое описание той сущности, на уровне которой определён.
Используется, в том числе, при генерации документации в формате [openAPI](https://swagger.io/specification).
В случае генерации `web` клиента, описание на уровне пакета используется в `package.json` для описания `npm` пакета.

## summary=\`Детальное описание метода <br/> Вторая строка описания с **жирным тестом**.\`

- метод

Детальное писание метода в генерируемой
документации [openAPI](https://swagger.io/docs/specification/paths-and-operations).
Поддерживает перенос строки и прочие возможности форматирования `openAPI`.

## <имя переменой в сигнатуре функции>.tags=<тэг>:<значение>|<тэг>:<значение>

Позволяет указать дополнительные теги в `exchange` структурах метода интерфейса или переопределить существующие.
Типичный пример - сокрытие чувствительных данных поля и логах:

```Go
...
// @sg token.tags=dumper:hide,md
Login(ctx context.Context, token string) (cookie *types.Cookie, err error)
...
```

В результате, в логах, середина строки `token` будет заменена на символы `*`.

## type=<тип>

- тип

Указывает тип поля в генерируемой документации, согласно
спецификации [openAPI](https://swagger.io/docs/specification/data-models/data-types/)

## enums=val1,val2,val3

- тип

Для поля можно перечислить список возможных значений.

## format=uuid

- тип

Указывает формат поля в генерируемой документации, согласно
спецификации [openAPI](https://swagger.io/docs/specification/data-models/data-types/)

## required

- тип

Указывает обязательность поля в генерируемой документации, согласно
спецификации [openAPI](https://swagger.io/docs/specification/data-models/data-types/)


## example=someExampleValue

- тип

Указывает пример значения поля в генерируемой документации, согласно
спецификации [openAPI](https://swagger.io/docs/specification/data-models/data-types/)

## http-args=<имя переменой в сигнатуре функции>|<имя ключа в URL>

- метод

Определяет маппинг параметров, переданных в параметрах `URL`, в аргументы метода.

## http-path=/<URL путь>/:<имя переменой в сигнатуре функции>

- метод

Определяет маппинг параметров, переданных в пути `URL`, в аргументы метода.
Переменные, которые попали в маппинг, исключаются из `exchange` структур.

## http-prefix=<префикс пути в URL>

- модуль
- интерфейс

Задаёт префикс к пути `URL` методов.
Формула пути, по которому доступен метода выглядит следующим образом:

`/globalPrefix/prefix/methodPath`

Где,

`globalPrefix` - префикс, объявленный на уровне пакета
`prefix` - префикс, объявленный на уровне интерфейса
`methodPath` - имя интерфейса/имя метода, но может быть переопределён через аннотацию `http-path` v

## http-headers=<имя переменой в сигнатуре функции>|<заголовок>

- метод

Определяет маппинг параметров, переданных в заголовках запроса, в аргументы/результаты метода.
Переменные, которые попали в маппинг, исключаются из `exchange` структур.

## http-cookies=<имя переменой в сигнатуре функции>|<заголовок>

- метод

Определяет маппинг параметров, переданных в `cookie` запроса, в аргументы/результаты метода.
Переменные, которые попали в маппинг, исключаются из `exchange` структур.

## http-method=<HTTP метод>

- метод

Указывает `HTTP` метод, который будет использован для доступа к методу интерфейса.

## http-success=<HTTP код>

- метод

Указывает `HTTP` код ответа, который будет считаться успешным, при доступе к методу интерфейса.

## packageJSON=\`<имя пакета>\`

- модуль

Переопределяет пакет, который будет использоваться для кодирования/декодирования `JSON`.
Используется для случаев, когда нужно особое поведение кодека или есть более оптимальный кодек, предоставляющий тот же
интерфейс, что и стандартный `encoding/json`.

Например, `github.com/seniorGolang/json` возвращает пустые срезы как `[]`, а не как `nil`, в стандартном `encoding/json`
и имеет ряд других оптимизаций по скорости работы.

## uuidPackage=\`<имя пакета>\`

- модуль

Переопределяет пакет, который будет использоваться для кодирования/декодирования `UUID`, при конвертации.
В замещающем пакете должен быть определён метод `Parse(s string) (UUID, error)`.
По умолчанию используется пакет `github.com/google/uuid`.

## swaggerTags=<тэг1,тэг2>

- интерфейс

Указывает теги для описания интерфейса в
формате [openAPI](https://swagger.io/docs/specification/grouping-operations-with-tags).

## log-skip=<имя переменой в сигнатуре функции>,<имя переменой в сигнатуре функции>

- метод

Указывает какие переменных из сигнатуры метода нужно исключить из логирования.

## deprecated

- метод

Помечает метод как - `deprecated` в документации [openAPI](https://swagger.io/docs/specification/paths-and-operations).

## tagNoOmitempty

- интерфейс

По умолчанию для всех полей методов включен тег `omitempty`, что исключает пустые поля из ответа.
Может существенно сэкономить трафик, но не всегда `fronend` готов к такому поведение и его можно выключить.

## http-response=<модуль Go>:<Метод>

- метод

Переключает работу метода в расширенный режим, добавляя контекст запроса go-fiber в обработчик.
Это означает, что для этого метода не генерируется никаких обработчиков http, а используется тот, который указан в аннотации.

Кастомный обработчик должен иметь следующую сигнатуру:

```Go
CustomHandler(ctx *fiber.Ctx, svc <тип интерфеса, к которому принадлежит метод>, <аргументы метода>) (err error)
```

Рекомендуется использовать кастомный обработчик когда нужно как-то по-особенному обработать нюансы http и невозможно имплементировать метод
другими способами. Например, в случаях upload/download файлов.
Логи и метрики будут работать, как обычно, при вызовах методов интерфейса.

## handler=<модуль Go>:<Метод>

- метод

Переключает работу метода в так называемый `кастомный` режим.
Это означает, что для этого метода не генерируется никаких обработчиков, а используется тот, который указан в аннотации.

Кастомный обработчик должен иметь следующую сигнатуру:

```Go
CustomHandler(ctx *fiber.Ctx, svc <тип интерфеса, к которому принадлежит метод без транспортного логера и метрик>) (err error)
```

Рекомендуется использовать кастомные обработчики только в крайнем случае, когда невозможно имплементировать метод
другими способами.
Т.к. то, что происходит в этом обработчик никак не формализовано, то логи, метрики и прочее нужно реализовать
самостоятельно.

## requestContentType=<mime тип>

- метод

Позволяет указать `mime` тип, который ожидается в запросе.
По умолчанию `application/ json`.

## responseContentType=<mime тип>

- метод

Позволяет указать `mime` тип, который ожидается в ответе.
По умолчанию `application/ json`.

## security=\`bearer\`

- модуль

Позволяет указать в документации [openAPI](https://swagger.io/docs/specification/authentication), что используется
авторизация.

## servers=`<адрес>;<имя>|<адрес>;<имя>`

- модуль

Указывает генератору документации список адресов, по которым доступен сервис и их человеко читаемые имена.

## version=<версия сервиса>

- модуль

Указывает генератору документации текущую версию сервиса.

## title=\`<заголовок документации к сервису>\`

- модуль

Указывает генератору документации заголовок к документации сервиса.

## author=\`автор сервиса\`

- модуль

Указывает генератору `NPM` модуля автора сервиса.

## npmRegistry=<адрес репозитория NPM>

- модуль

Указывает генератору `NPM` модуля адрес репозитория, где будет опубликован клиент.

## npmName=<имя пакета NPM>

- модуль

Указывает генератору `NPM` модуля имя пакета, под которым будет опубликован клиент.

## npmPrivate=<true|false>

- модуль

Указывает генератору `NPM` модуля является ли он публичным или приватным.

## license=<вид лицензии>

- модуль

Указывает генератору `NPM` модуля под какой лицензией он распространяется.

## http-server

- интерфейс

Включает генерацию `HTTP` сервера на базе интерфейса.

## jsonRPC-server

- интерфейс

Включает генерацию [jsonRPC 2.0](https://www.jsonrpc.org/specification) сервера на базе интерфейса.
